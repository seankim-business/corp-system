# =============================================================================
# Redis Sentinel Configuration for Nubabel
# =============================================================================
# Deploy 3 Sentinel instances for high availability.
# Each Sentinel monitors the master and handles automatic failover.
#
# Usage:
#   redis-sentinel /path/to/redis-sentinel.conf
#
# Typical deployment:
#   - 3 Sentinel instances on separate hosts/containers
#   - 1 Redis master + 2 Redis replicas
#   - Sentinels coordinate failover if master goes down
# =============================================================================

# Network
port 26379
bind 0.0.0.0
protected-mode no

# =============================================================================
# Master Monitoring
# =============================================================================

# sentinel monitor <master-name> <ip> <port> <quorum>
# Quorum = number of Sentinels that must agree master is down before failover
sentinel monitor nubabel-master 127.0.0.1 6379 2

# Authentication (uncomment if Redis requires password)
# sentinel auth-pass nubabel-master YOUR_REDIS_PASSWORD

# =============================================================================
# Failover Settings
# =============================================================================

# How long (ms) the master must be unreachable before marking it as down
sentinel down-after-milliseconds nubabel-master 5000

# Timeout for failover operation (ms)
sentinel failover-timeout nubabel-master 60000

# How many replicas can be reconfigured simultaneously after failover
sentinel parallel-syncs nubabel-master 1

# =============================================================================
# Notification & Scripting
# =============================================================================

# Script to call when failover starts (for alerting)
# sentinel notification-script nubabel-master /opt/nubabel/scripts/sentinel-notify.sh

# Script to call after failover completes (for DNS update, etc.)
# sentinel client-reconfig-script nubabel-master /opt/nubabel/scripts/sentinel-reconfig.sh

# =============================================================================
# Logging
# =============================================================================

loglevel notice
logfile "/var/log/redis/sentinel.log"

# =============================================================================
# Persistence
# =============================================================================

# Sentinel state is automatically persisted to this config file.
# dir must be writable by the Redis process.
dir /var/lib/redis

# =============================================================================
# ACL (Redis 6+)
# =============================================================================

# Sentinel-specific ACL for Sentinel-to-Sentinel communication
# sentinel sentinel-user sentinel-user
# sentinel sentinel-pass sentinel-password

# =============================================================================
# Environment-specific overrides
# =============================================================================
# For production, override these via environment variables or include files:
#
# Railway/Docker deployment:
#   REDIS_SENTINEL_MASTER_HOST=redis-master.internal
#   REDIS_SENTINEL_MASTER_PORT=6379
#   REDIS_SENTINEL_QUORUM=2
#
# Connection from Node.js (ioredis):
#   const redis = new Redis({
#     sentinels: [
#       { host: "sentinel-1", port: 26379 },
#       { host: "sentinel-2", port: 26379 },
#       { host: "sentinel-3", port: 26379 },
#     ],
#     name: "nubabel-master",
#   });
