schema_version: "1.0"
kind: SOP

metadata:
  id: customer-onboarding
  name: 신규 고객 온보딩
  function: cs
  owner: cs-team-lead
  version: 1.0.0

triggers:
  - pattern: "신규 고객 온보딩"
  - pattern: "고객 온보딩 시작"
  - pattern: "new customer onboarding"

steps:
  - id: welcome-email
    name: 환영 이메일 발송
    description: 신규 고객에게 환영 이메일을 발송합니다.
    type: automated
    agent: cs-agent
    tool: send_email
    input:
      template: welcome-email
      to: "{{customer.email}}"
      subject: "환영합니다! Nubabel 시작하기"
    timeout: 5m

  - id: kickoff-meeting
    name: 킥오프 미팅 예약
    description: 고객과의 첫 미팅을 예약합니다.
    type: manual
    requires_approval: false
    assignee: cs-manager
    checklist:
      - 고객 일정 확인
      - 미팅룸 예약
      - 참석자 초대

  - id: account-setup
    name: 계정 설정
    description: 고객 계정을 설정하고 초기 구성을 완료합니다.
    type: approval_required
    approver: cs-team-lead
    timeout: 24h
    input:
      organization_name: "{{customer.company_name}}"
      admin_email: "{{customer.email}}"
      plan: "{{customer.subscription_plan}}"

  - id: training-schedule
    name: 교육 일정 수립
    description: 고객 팀을 위한 교육 일정을 수립합니다.
    type: manual
    requires_approval: false
    assignee: cs-specialist
    checklist:
      - 교육 자료 준비
      - 교육 일정 확정
      - 교육 링크 발송

  - id: completion-notification
    name: 온보딩 완료 알림
    description: 온보딩 완료를 관련 팀에 알립니다.
    type: automated
    agent: cs-agent
    tool: notify_slack
    input:
      channel: "#customer-success"
      message: "{{customer.company_name}} 온보딩이 완료되었습니다."

exception_handling:
  - condition: "step.failed"
    action: notify_owner
    message: "SOP 단계 실패: {{step.name}}"
  - condition: "step.timeout"
    action: escalate
    target: cs-team-lead
    message: "단계 타임아웃: {{step.name}}"
  - condition: "approval.rejected"
    action: retry_with_modification
    max_retries: 2
