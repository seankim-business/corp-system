# Kyndof Corp System - Environment Variables Template
# Copy this file to .env and fill in your values

# ============================================================================
# DATABASE
# ============================================================================
DATABASE_URL="postgresql://user:password@localhost:5432/kyndof_corp"

# ============================================================================
# GOOGLE OAUTH (Workspace SSO)
# ============================================================================
# Get these from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID="your-client-id.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="your-client-secret"
GOOGLE_REDIRECT_URI="https://auth.nubabel.com/auth/google/callback"

# Optional: Service Account for Admin SDK
GOOGLE_SERVICE_ACCOUNT_EMAIL="service-account@project.iam.gserviceaccount.com"
GOOGLE_SERVICE_ACCOUNT_KEY="path/to/service-account-key.json"

# ============================================================================
# JWT (Session Tokens)
# ============================================================================
# Generate: openssl rand -base64 32
JWT_SECRET="your-super-secret-jwt-key-change-this"
JWT_EXPIRES_IN="7d"
JWT_REFRESH_EXPIRES_IN="30d"

# ============================================================================
# APPLICATION
# ============================================================================
NODE_ENV="development" # development | production
PORT="3000"
BASE_URL="https://auth.nubabel.com" # Used for Playwright tests and API endpoint
FRONTEND_URL="https://app.nubabel.com"  # Frontend app URL (for OAuth redirect)
BASE_DOMAIN="nubabel.com"
COOKIE_DOMAIN=.nubabel.com
FRONTEND_URL="https://nubabel.com" # Frontend app URL for redirects after auth

# ============================================================================
# REDIS (Required for orchestrator session management + BullMQ)
# ============================================================================
# Local development (no TLS):
REDIS_URL="redis://localhost:6379"

# Production (Railway auto-provides rediss:// with TLS):
# REDIS_URL="rediss://default:password@host:port"

# Optional: Password authentication (if not in URL)
REDIS_PASSWORD=""

# BullMQ uses same Redis instance
BULLMQ_REDIS_URL="redis://localhost:6379"

# ============================================================================
# MONITORING (Optional)
# ============================================================================
# Sentry Error Tracking
# Get from: https://sentry.io/settings/projects/nubabel/keys/
SENTRY_DSN=""
LOG_LEVEL="info" # debug | info | warn | error

# ============================================================================
# OPENCODE SIDECAR (AI Orchestration HTTP Bridge)
# ============================================================================
# Leave empty to use built-in AI executor (Anthropic SDK direct)
# Set to enable external OpenCode sidecar service
# OPENCODE_SIDECAR_URL="http://localhost:3001"
# OPENCODE_SIDECAR_TIMEOUT="120000"

# Built-in AI executor (fallback when sidecar not configured)
USE_BUILTIN_AI="true"

# ============================================================================
# AI / LLM PROVIDERS (For hybrid routing)
# ============================================================================
ANTHROPIC_API_KEY="sk-ant-..."
OPENAI_API_KEY="sk-..."

# ============================================================================
# MULTI-ACCOUNT SYSTEM (Claude Account Management)
# ============================================================================
# Encryption key for sensitive data (API keys, tokens)
# Generate: openssl rand -hex 32
ENCRYPTION_KEY="your-64-character-hex-key-here"

# Encryption (generate with: openssl rand -hex 32)
ENCRYPTION_SECRET=your-32-char-minimum-secret-key-here

# Optional: Anthropic Admin API Key for quota monitoring
# Get from: https://console.anthropic.com/settings/admin-api-keys
ANTHROPIC_ADMIN_API_KEY=""

# Slack Alert Channels
SLACK_ALERT_CHANNEL="#eng-alerts"
SLACK_ACTIVITY_CHANNEL="#it-test"

# Railway Token (for QA automation)
# Get from: railway whoami --token
RAILWAY_TOKEN=""

# ============================================================================
# NOTION MCP (Example - managed via MCPConnection table)
# ============================================================================
# These are examples - actual connections managed in UI
# NOTION_API_KEY="secret_..."
# NOTION_TASKS_DB_ID=""

# ============================================================================
# NOTION WEBHOOKS (Feature Request Pipeline)
# ============================================================================
# Get from: https://www.notion.so/my-integrations
NOTION_API_KEY="secret_..."
NOTION_WEBHOOK_SECRET="your-webhook-secret"
DEFAULT_ORGANIZATION_ID="your-default-org-id"

# ============================================================================
# SLACK BOT (Socket Mode for Orchestrator)
# ============================================================================
# 
# TWO MODES OF OPERATION:
#
# 1. TEST/DEV ENVIRONMENT (env vars below):
#    - Set these env vars for local development
#    - Bot runs with YOUR test Slack app credentials
#    - Good for: development, debugging, testing
#
# 2. PRODUCTION MULTI-TENANT (BYOA - Bring Your Own App):
#    - Tenants register their OWN Slack app via WebUI (/settings/slack)
#    - Credentials stored encrypted in SlackIntegration table
#    - Bot dynamically authorizes per-workspace using stored tokens
#    - Good for: production, multi-org deployment
#
# For test environment setup:
#   1. Create Slack App: https://api.slack.com/apps
#   2. Enable Socket Mode (Settings > Socket Mode)
#   3. Add Bot Token Scopes: app_mentions:read, chat:write, users:read, team:read
#   4. Install to workspace and get tokens
#
# ============================================================================
SLACK_BOT_TOKEN="xoxb-your-bot-token"
SLACK_APP_TOKEN="xapp-your-app-token"
SLACK_SIGNING_SECRET="your-signing-secret"
SLACK_SOCKET_MODE="true"
SLACK_LOG_LEVEL="INFO"
SLACK_ALERT_CHANNEL="#eng-alerts"

# ============================================================================
# QUEUE CONFIGURATION (BullMQ)
# ============================================================================
QUEUE_SLACK_CONCURRENCY="5"
QUEUE_ORCHESTRATION_CONCURRENCY="3"
QUEUE_NOTIFICATION_CONCURRENCY="10"

# ============================================================================
# EMAIL (For invitations)
# ============================================================================
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_USER=""
SMTP_PASSWORD=""
EMAIL_FROM="noreply@nubabel.com"

# ============================================================================
# IDENTITY SYSTEM (User Linking & External Identity Management)
# ============================================================================
# Enable dual-write to both slack_users and external_identities tables
# during migration period. Set to "true" during transition, "false" after
# all legacy systems have migrated to ExternalIdentity.
# Default: "true" (enabled for backward compatibility)
ENABLE_IDENTITY_DUAL_WRITE="true"
